<html>
	<head>
		<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.7.2/build/cssreset/cssreset-min.css" />
		<link rel="stylesheet" type="text/css" href="e3Radio.css" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	</head>
	<body>

		<div class="wrapper">
			<div id="e3r"></div>
		</div>	

		<script type="text/html" id="menu">
			<ul>
				<li><a href="#">Coming Up</a></li>
				<li><a href="#chart/best">Best</a></li>
				<li><a href="#chart/worst">Worst</a></li>
				<li><a href="#chart/popular">Popular</a></li>
			</ul>
		</script>

		<script type="text/html" id="page">
			<%= header %>
			<div class="content">
				<article>
					<%= article %>	
					<div class="clear"></div>
				</article>
				<aside>
					<h2><a name="menu">Charts</a></h2>
					<menu><%= menu %></menu>	
				</aside>
			</div>
			<%= footer %>
		</script>

		<script type="text/html" id="logo">
			<h1>e3Radio.</h1>
		</script>

<!--

    "TrackPlayedID": 27162,
    "DatePlayed": "\/Date(1349085030297+0100)\/",
    "TrackID": 59417,
    "Artist": "Skrillex",
    "TrackName": "Kill EVERYBODY",
    "Album": "Scary Monsters and Nice Sprites",
    "LastFmLink": null,
    "PictureSmall": null,
    "PictureMedium": null,
    "PictureLarge": null,
    "PictureExtraLarge": null,
    "DateAdded": "\/Date(1348834956283+0100)\/",
    "Likes": 0,
    "Dislikes": 0,
    "iLike": null,
    "SpotifyUri": "spotify:track:1u1Ps262k227FPAm5BVUjd",
    "TrackLikes": []
-->

		<script type="text/html" id="tracks">
			<% _.each(tracks, function(track){ 
					var img = track.PictureExtraLarge ? 'url(' + track.PictureExtraLarge +')' : 'none';
				%>
				<li style="background: <%= img %>">
					<p data-id="<%= track.TrackPlayedID %>">
						<span class="number"> </span>
						<span class="info">
							<span class="artist"><em><%= track.Artist %></em></span>
							<span class="title"><em><%= track.TrackName %></em></span>
						</span>
					</p>
				</li>
			<% }) %>
		</script>

		<script type="text/html" id="header">
			<header>
				<menu>
					<ul>
						<li><a href="#">Charts</a>
							<%= menu %>
						</li>
						<li><a href="#">Login</a></li>
						<li><a href="#menu">Menu</a></li>
					</ul>
				</menu>	
				<%= logo %>
			</header>
			<div class="search">
				<form>
					<input type="text" placeholder="Democratically creating the ultimate e3 playlist...">
				</form>
			</div>
		</script>

		<script type="text/html" id="footer">
			<footer>
				<p><a href="http://e3.co.uk">http://e3.co.uk</a></p>
			</footer>	
		</script>

		<script type="text/html" id="chart">
			<ul id="tracks"></ul>
		</script>

		<script type="text/html" id="detail">
			<div class="track-details"></div>
		</script>		


<script type="text/template" id="tweetsTemplate">
    <% _.each(tweets, function (tweet) { %>
    <div class="tweet">
        <p>@<%= tweet.from_user %></p>
        <p class="text"><%= tweet.text %></p><p><%= tweet.location %></p>
    </div>
    <% }); %>
</script>
		<script type="text/html" id="loading"></script>

		<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
		<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
		<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2.js"></script>
		<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"></script>
		<script type="text/javascript" src="util.js"></script>
		<script type="text/javascript" src="data.js"></script>
		<script type="text/javascript">



			// Define the collection
			var tracks = Backbone.Collection.extend(
			    {
			        model: Backbone.Model.extend(),
			        // Url to request when fetch() is called
			        url: 'trackswithlikes.json',
			        parse: function(response) {
			            return response;
			        },
			        // Overwrite the sync method to pass over the Same Origin Policy
			        sync: function(method, model, options) {
			            var that = this;
			                var params = _.extend({
			                    //type: 'GET',
			                    //dataType: 'jsonp',
			                    url: that.url,
			                    processData: false
			                }, options);

			            return $.ajax(params);
			        }
			    });

			// Define the View
			chartView = Backbone.View.extend({
			    initialize: function() {
			      _.bindAll(this, 'render');
			      // create a collection
			      this.collection = new tracks;
			      // Fetch the collection and call render() method
			      var that = this;
			      this.collection.fetch({
			        success: function () {
			            that.render();
			        }
			      });
			    },
			    // Use an extern template
			    template: _.template($('#tracks').html()),

			    render: function() {
			        // Fill the html with the template and the collection
			        $(this.el).html(this.template({ tracks: this.collection.toJSON() }));
			    }
			});

			var chart = new chartView({
			    // define the el where the view will render
			    el: $('#e3r')
			});
			/*

			var chart = (function(){

				return {
					get: function(cb){
						data.get({
							url: 'toptracks.xml',
							success: function($d){

								var $tracks = $('#tracks');
									
								$d.find('toptracks track').each(function(){

									var $this = $(this);	
									var d = data.trackData($this);

									$(_.template($('#track').html(), d)).appendTo($tracks).find('p').css({
										backgroundImage: d.image ? 'url(' + d.image + ')' : 'none' 
									});

								});

								/////////

								$tracks.find('p').on('click', function(){
									router.navigate('track/' + $(this).data('id'), { trigger: true });
								});

							}
						});
					}

				}

			})();


			var ListView = Backbone.View.extend({    
		    	el: $('#e3r'), // attaches `this.el` to an existing element.
		    	initialize: function(){
		      	_.bindAll(this, 'render'); // fixes loss of context for 'this' within methods
		       
		       	this.render(); // not all views are self-rendering. This one is.
		    	},
		    	render: function(){
		      	$(this.el).append("<ul> <li>hello world</li> </ul>");
		    	}
		  	});

		  var listView = new ListView();  			

			//////////////////
						*/

			var routes = Backbone.Router.extend({
			    routes: {
			        "": "defaultRoute",
			        "chart/:id": "chart",
					"track/:id": "track"
			    },
			    defaultRoute: function () {
					//util.page('chart');
					//chart.get('coming-up');
			    },
			    chart: function(id){
			    	//util.page('chart');
			    	//chart.get(id);	
			    },
			    track: function(id){
			    	
			    	//data.track(id, {
			    	//	success: function(d){
			    	//		console.log(d);
			    	//		util.page('detail', d);		
			    	//	}
			    	//});
			    	
			    }
			});

			//////////////////////////////////////////////////

			var router = new routes();

			Backbone.history.start();

			/////////////////////////////////


		</script>

	</body>	
</html>